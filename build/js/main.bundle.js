(()=>{var e={735:()=>{const e=["gif","jpg","jpeg","png"],t=(e,t,r)=>o=>{o.preventDefault();const n=e.files[0],a=n.name.toLowerCase();if(r.some((e=>a.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{t.src=e.result})),e.readAsDataURL(n)}},r=document.querySelector(".ad-form__field input[type=file]"),o=document.querySelector(".ad-form-header__preview img"),n=document.querySelector(".ad-form__upload input[type=file]"),a=document.querySelector(".ad-form__photo"),c=document.createElement("img");c.style.display="flex",c.style.maxWidth="100%",c.style.height="auto",a.append(c),r.addEventListener("change",t(r,o,e)),n.addEventListener("change",t(n,c,e))}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}(()=>{"use strict";const e=document.querySelector("#card").content.querySelector(".popup"),t=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),o=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),n=o.querySelector(".error__button");t.classList.add("hidden"),o.classList.add("hidden"),document.body.append(t),document.body.append(o);const a=e=>{e.classList.add("hidden")},c=e=>t=>{t.preventDefault(),a(e)},l=e=>t=>{((e=>"Escape"===e.key||"Esc"===e.key)(t)||(e=>"Enter"===e.key)(t))&&(t.preventDefault(),document.removeEventListener("keydown",l(e)),e.removeEventListener("click",c(e)),a(e)),e===o&&n.removeEventListener("click",c(o))},s=e=>{e.classList.remove("hidden"),e.style.zIndex="1000",document.addEventListener("keydown",l(e)),e.addEventListener("click",c(e))},i=document.querySelector(".ad-form"),u=i.querySelectorAll("fieldset"),d=i.querySelector("#title"),p=i.querySelector("#price"),y=i.querySelector("#address"),m=i.querySelector("#type"),v=i.querySelector("#timein"),f=i.querySelector("#timeout"),h=i.querySelector("#room_number"),g=i.querySelector(".ad-form__reset"),S=i.querySelector("#capacity"),b=document.querySelector(".map__filters"),q=b.querySelectorAll(".map__filter, .map__features"),E={bungalow:0,flat:1e3,house:5e3,palace:1e4},x=(e,t)=>{const r=e.toFixed(5),o=t.toFixed(5);y.value=`${r} ${o}`},k={1:[1],2:[1,2],3:[1,2,3],100:[0]};u.forEach((e=>{e.setAttribute("disabled","")})),b.classList.add("map__filters--disabled"),q.forEach((e=>{e.setAttribute("disabled","")}));const w=()=>{const e=S.querySelectorAll("option"),t=Number(h.value),r=k[t];e.forEach((e=>{e.disabled=!0})),r.forEach((t=>{if(e.forEach((e=>{Number(e.value)===t&&(e.disabled=!1)})),!r.includes(Number(S.value))){const e=r[r.length-1];S.value=e}}))};h.addEventListener("change",w),v.addEventListener("change",(()=>{f.value=v.value})),f.addEventListener("change",(()=>{v.value=f.value})),p.placeholder=E[m.value],p.addEventListener("input",(()=>{const e=p.value,t=m.value,r=E[t];e<r?p.setCustomValidity(`Стоимость должна быть не менее ${r}`):e>1e6?p.setCustomValidity("Стоимость не должна превышать 1000000"):p.setCustomValidity(""),p.reportValidity()})),m.addEventListener("change",(()=>{p.placeholder=E[m.value],p.min=E[m.value]})),d.addEventListener("input",(()=>{const e=d.value.length;e<30?d.setCustomValidity("Ещё "+(30-e)+" симв."):e>100?d.setCustomValidity("Удалите лишние "+(e-100)+" симв."):d.setCustomValidity(""),d.reportValidity()}));const C=()=>{i.reset(),b.reset(),W(),w()};var A,V;g.addEventListener("click",(e=>{e.preventDefault(),C()})),A=()=>{s(t),C()},V=()=>{s(o),n.addEventListener("click",c(o))},i.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(e.target);((e,t,r,o)=>{fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:o}).then((e=>{if(e.ok)return t();r()})).catch(r)})(0,A,V,t)}));const N=b.querySelector("#housing-type"),D=b.querySelector("#housing-price"),T=b.querySelector("#housing-rooms"),j=b.querySelector("#housing-guests"),z=b.querySelector("#housing-features"),$=e=>(e=>"any"===N.value||e.offer.type===N.value)(e)&&(e=>{switch(D.value){case"any":return!0;case"low":return e.offer.price<1e4;case"middle":return e.offer.price>=1e4&&e.offer.price<5e4;case"high":return e.offer.price>=5e4;default:return!1}})(e)&&(e=>"any"===T.value||e.offer.rooms===Number(T.value))(e)&&(e=>"any"===j.value||e.offer.guests===Number(j.value))(e)&&(e=>{const t=z.querySelectorAll(".map__checkbox:checked");let r=0;return t.forEach((t=>{e.offer.features.includes(t.value)&&r++})),r===t.length})(e),F=35.6804,M=139.769,U=L.map("map-canvas").on("load",(()=>{u.forEach((e=>{e.removeAttribute("disabled","")})),b.classList.remove("map__filters--disabled"),q.forEach((e=>{e.removeAttribute("disabled","")})),x(F,M)})).setView({lat:F,lng:M},10);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(U);const H=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),I=L.marker({lat:F,lng:M},{draggable:!0,icon:H}).addTo(U),O=e=>{const t=e.target.getLatLng().lat,r=e.target.getLatLng().lng;x(t,r)};I.on("move",O);const P=[],R=t=>{t.slice().filter($).slice(0,10).forEach((t=>{const{location:r}=t,o=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),n=L.marker({lat:r.lat,lng:r.lng},{icon:o});n.addTo(U).bindPopup((({author:t,offer:r})=>{const o=e.cloneNode(!0),n=o.querySelector(".popup__features"),a=o.querySelector(".popup__photos");var c,l;return o.querySelector(".popup__title").textContent=r.title,o.querySelector(".popup__text--address").textContent=r.address,o.querySelector(".popup__text--price").textContent=r.price,o.querySelector(".popup__type").textContent={flat:"Квартрира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"}[r.type],o.querySelector(".popup__text--capacity").textContent=r.rooms+" комнаты для "+r.guests+" гостей.",o.querySelector(".popup__text--time").textContent=" Заезд после "+r.checkin+", выезд до "+r.checkout,((e,t)=>{var r;r=e,(0===t.features.length?(r.setAttribute("style","visibility: hidden;"),0):(r.setAttribute("style","visibility: visible;"),1))&&(e.innerHTML=t.features.map((e=>`<li class="popup__feature popup__feature--${e}"></li>`)).join(""))})(n,r),c=a,l=r.photos,c.innerHTML="",l.forEach((e=>{const t=document.createElement("img");t.src=e,t.width=45,t.height=40,c.appendChild(t)})),o.querySelector(".popup__avatar").src=t.avatar,o})(t),{}),n.on("click",O),P.push(n)}))},W=()=>{U.setView({lat:F,lng:M},10),I.setLatLng(L.latLng(F,M))};r(735),((e,t,r)=>{fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();r(`Не удалось загрузить данные об объектах: ${e.text}`)})).then((e=>{var t;R(e),t=_.debounce((()=>{P.forEach((e=>{e.remove()})),R(e)}),500),b.addEventListener("change",(()=>{t()})),C()})).catch(r)})(0,0,((e="Не удалось загрузить данные")=>()=>{const t=document.createElement("div");t.style.display="block",t.style.zIndex="100",t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.right="0",t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})("Не удалось загрузить данные об объектах"))})()})();
//# sourceMappingURL=main.bundle.js.map