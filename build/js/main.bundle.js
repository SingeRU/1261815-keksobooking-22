(()=>{var e={735:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector(".ad-form__upload input[type=file]"),r=document.querySelector(".ad-form__photo img");t.addEventListener("change",(()=>{const o=t.files[0],n=o.name.toLowerCase();if(e.some((e=>n.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{r.src=e.result})),e.readAsDataURL(o)}}))}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}(()=>{"use strict";const e=document.querySelector("#card").content.querySelector(".popup"),t="https://22.javascript.pages.academy/keksobooking",o=document.querySelector(".ad-form"),n=o.querySelectorAll("fieldset"),a=o.querySelector("#title"),l=o.querySelector("#price"),s=o.querySelector("#address"),c=o.querySelector("#type"),i=o.querySelector("#timein"),u=o.querySelector("#timeout"),d=o.querySelector("#room_number"),p=o.querySelector(".ad-form__reset"),y=o.querySelector("#capacity"),m=document.querySelector(".map__filters"),f=m.querySelectorAll(".map__filter, .map__features"),h={bungalow:0,flat:1e3,house:5e3,palace:1e4},g=()=>{l.placeholder=h[c.value],l.min=h[c.value]},v={1:[1],2:[1,2],3:[1,2,3],100:[0]};n.forEach((e=>{e.setAttribute("disabled","")})),m.classList.add("map__filters--disabled"),f.forEach((e=>{e.setAttribute("disabled","")})),d.addEventListener("input",(()=>{const e=y.querySelectorAll("option"),t=d.value;e.forEach((e=>{e.disabled=!0})),v[t].forEach((r=>{if(e.forEach((e=>{Number(e.value)===r&&(e.disabled=!1)})),!v[t].includes(y.value)){const e=v[t][v[t].length-1];y.value=e}}))})),i.addEventListener("change",(()=>{u.value=i.value})),u.addEventListener("change",(()=>{i.value=u.value})),l.addEventListener("input",(()=>{g(),l.value<l.min?l.setCustomValidity("Минимальная цена за ночь "+l.min+" руб."):l.setCustomValidity(""),l.reportValidity()})),c.addEventListener("change",(()=>{g()})),a.addEventListener("input",(()=>{const e=a.value.length;e<30?a.setCustomValidity("Ещё "+(30-e)+" симв."):e>100?a.setCustomValidity("Удалите лишние "+(e-100)+" симв."):a.setCustomValidity(""),a.reportValidity()}));const S=()=>{const e=document.createElement("div");e.style.width="330px",e.style.height="150px",e.style.position="fixed",e.style.zIndex=1e3,e.style.left="37%",e.style.top="100%",e.style.paddingTop="66px",e.style.fontSize="15px",e.style.fontWeight="bold",e.style.textAlign="center",e.style.backgroundColor="white",e.textContent="Ваше объявление успешно размещено!",document.body.append(e),setTimeout((()=>e.remove()),5e3)},x=()=>{const e=document.createElement("div");e.style.zIndex=100,e.style.position="fixed",e.style.left=0,e.style.top=0,e.style.right=0,e.style.padding="10px 3px",e.style.fontSize="30px",e.style.textAlign="center",e.style.backgroundColor="red",e.textContent="Неудалось отправить форму! Попробуйте ещё раз.",document.body.append(e),setTimeout((()=>e.remove()),5e3)},q=()=>{o.reset(),m.reset(),U()};o.addEventListener("submit",(e=>{var r,o;e.preventDefault(),new FormData(e.target),r=t,o=S,fetch(t,{method:"POST",body:x}).then((e=>{if(e.ok)return r();o()})).catch((()=>{o()})),q()})),p.addEventListener("click",(e=>{e.preventDefault(),q()}));const b=m.querySelector("#housing-type"),E=m.querySelector("#housing-price"),C=m.querySelector("#housing-rooms"),k=m.querySelector("#housing-guests"),w=m.querySelector("#housing-features"),A=e=>(e=>"any"===b.value||e.offer.type===b.value)(e)&&(e=>{switch(E.value){case"any":return!0;case"low":return e.offer.price<1e4;case"middle":return e.offer.price>=1e4&&e.offer.price<5e4;case"high":return e.offer.price>=5e4;default:return!1}})(e)&&(e=>"any"===C.value||e.offer.rooms===Number(C.value))(e)&&(e=>"any"===k.value||e.offer.guests===Number(k.value))(e)&&(e=>{const t=w.querySelectorAll(".map__checkbox:checked");let r=0;return t.forEach((t=>{e.offer.features.includes(t.value)&&r++})),r===t.length})(e),T=35.6804,V=139.769,z=L.map("map-canvas").on("load",(()=>{n.forEach((e=>{e.removeAttribute("disabled","")})),m.classList.remove("map__filters--disabled"),f.forEach((e=>{e.removeAttribute("disabled","")}))})).setView({lat:T,lng:V},10);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(z);const j=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),D=L.marker({lat:T,lng:V},{draggable:!0,icon:j}).addTo(z),F=e=>{((e,t)=>{const r=e.toFixed(5),o=t.toFixed(5);s.value=`${r} ${o}`})(e.target.getLatLng().lat,e.target.getLatLng().lng)};D.on("move",F);const N=[],M=t=>{t.slice().filter(A).slice(0,10).forEach((t=>{const{location:r}=t,o=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),n=L.marker({lat:r.lat,lng:r.lng},{icon:o});n.addTo(z).bindPopup((({author:t,offer:r})=>{const o=e.cloneNode(!0),n=o.querySelector(".popup__features"),a=o.querySelector(".popup__photos");var l,s;return o.querySelector(".popup__title").textContent=r.title,o.querySelector(".popup__text--address").textContent=r.address,o.querySelector(".popup__text--price").textContent=r.price,o.querySelector(".popup__type").textContent=r.type,o.querySelector(".popup__text--capacity").textContent=r.rooms+" комнаты для "+r.guests+" гостей.",o.querySelector(".popup__text--time").textContent=" Заезд после "+r.checkin+", выезд до "+r.checkout,o.querySelector(".popup__features").textContent=r.features,l=n,s=r.features,l.innerHTML="",s.forEach((e=>{const t=document.createElement("li");t.classList.add(`feature-item--${e}`),l.appendChild(t),t.textContent=e})),((e,t)=>{e.innerHTML="",t.forEach((t=>{const r=document.createElement("img");r.src=t,r.width=45,r.height=40,e.appendChild(r)}))})(a,r.photos),o.querySelector(".popup__avatar").src=t.avatar,o})(t),{}),n.on("click",F),N.push(n)}))},U=()=>{z.setView({lat:T,lng:V},10),D.setLatLng(L.latLng(T,V))};var $,H;$=e=>{var t;M(e),t=_.debounce((()=>{N.forEach((e=>{e.remove()})),M(e)}),500),m.addEventListener("change",(()=>{t()}))},H=x,fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then($).catch(H),r(735)})()})();
//# sourceMappingURL=main.bundle.js.map