(()=>{"use strict";const e=document.querySelector("#card").content.querySelector(".popup"),t=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),r=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),o=r.querySelector(".error__button");t.classList.add("hidden"),r.classList.add("hidden"),document.body.append(t),document.body.append(r);const n=e=>{e.classList.add("hidden")},a=e=>t=>{t.preventDefault(),n(e)},c=e=>t=>{((e=>"Escape"===e.key||"Esc"===e.key)(t)||(e=>"Enter"===e.key)(t))&&(t.preventDefault(),document.removeEventListener("keydown",c(e)),e.removeEventListener("click",a(e)),n(e)),e===r&&o.removeEventListener("click",a(r))},l=e=>{e.classList.remove("hidden"),e.style.zIndex="1000",document.addEventListener("keydown",c(e)),e.addEventListener("click",a(e))},s=document.querySelector(".ad-form"),i=s.querySelectorAll("fieldset"),u=s.querySelector("#title"),d=s.querySelector("#price"),p=s.querySelector("#address"),y=s.querySelector("#type"),m=s.querySelector("#timein"),v=s.querySelector("#timeout"),h=s.querySelector("#room_number"),f=s.querySelector(".ad-form__reset"),g=s.querySelector("#capacity"),b=document.querySelector(".map__filters"),S=b.querySelectorAll(".map__filter, .map__features"),q={bungalow:0,flat:1e3,house:5e3,palace:1e4},E=(e,t)=>{const r=e.toFixed(5),o=t.toFixed(5);p.value=`${r} ${o}`},k={1:[1],2:[1,2],3:[1,2,3],100:[0]};i.forEach((e=>{e.setAttribute("disabled","")})),b.classList.add("map__filters--disabled"),S.forEach((e=>{e.setAttribute("disabled","")}));const x=()=>{const e=g.querySelectorAll("option"),t=Number(h.value),r=k[t];e.forEach((e=>{e.disabled=!0})),r.forEach((t=>{if(e.forEach((e=>{Number(e.value)===t&&(e.disabled=!1)})),!r.includes(Number(g.value))){const e=r[r.length-1];g.value=e}}))};h.addEventListener("change",x),m.addEventListener("change",(()=>{v.value=m.value})),v.addEventListener("change",(()=>{m.value=v.value})),d.placeholder=q[y.value],d.addEventListener("input",(()=>{const e=d.value,t=y.value,r=q[t];e<r?d.setCustomValidity(`Стоимость должна быть не менее ${r}`):e>1e6?d.setCustomValidity("Стоимость не должна превышать 1000000"):d.setCustomValidity(""),d.reportValidity()})),y.addEventListener("change",(()=>{d.placeholder=q[y.value],d.min=q[y.value]})),u.addEventListener("input",(()=>{const e=u.value.length;e<30?u.setCustomValidity("Ещё "+(30-e)+" симв."):e>100?u.setCustomValidity("Удалите лишние "+(e-100)+" симв."):u.setCustomValidity(""),u.reportValidity()}));const C=()=>{s.reset(),b.reset(),B(),x()};var w,A;f.addEventListener("click",(e=>{e.preventDefault(),C()})),w=()=>{l(t),C()},A=()=>{l(r),o.addEventListener("click",a(r))},s.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(e.target);((e,t,r,o)=>{fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:o}).then((e=>{if(e.ok)return t();r()})).catch(r)})(0,w,A,t)}));const V=b.querySelector("#housing-type"),N=b.querySelector("#housing-price"),T=b.querySelector("#housing-rooms"),z=b.querySelector("#housing-guests"),D=b.querySelector("#housing-features"),$=e=>(e=>"any"===V.value||e.offer.type===V.value)(e)&&(e=>{switch(N.value){case"any":return!0;case"low":return e.offer.price<1e4;case"middle":return e.offer.price>=1e4&&e.offer.price<5e4;case"high":return e.offer.price>=5e4;default:return!1}})(e)&&(e=>"any"===T.value||e.offer.rooms===Number(T.value))(e)&&(e=>"any"===z.value||e.offer.guests===Number(z.value))(e)&&(e=>{const t=D.querySelectorAll(".map__checkbox:checked");let r=0;return t.forEach((t=>{e.offer.features.includes(t.value)&&r++})),r===t.length})(e),j=35.6804,F=139.769,M=L.map("map-canvas").on("load",(()=>{i.forEach((e=>{e.removeAttribute("disabled","")})),b.classList.remove("map__filters--disabled"),S.forEach((e=>{e.removeAttribute("disabled","")})),E(j,F)})).setView({lat:j,lng:F},10);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(M);const H=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),I=L.marker({lat:j,lng:F},{draggable:!0,icon:H}).addTo(M),O=e=>{const t=e.target.getLatLng().lat,r=e.target.getLatLng().lng;E(t,r)};I.on("move",O);const P=[],U=t=>{t.slice().filter($).slice(0,10).forEach((t=>{const{location:r}=t,o=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),n=L.marker({lat:r.lat,lng:r.lng},{icon:o});n.addTo(M).bindPopup((({author:t,offer:r})=>{const o=e.cloneNode(!0),n=o.querySelector(".popup__features"),a=o.querySelector(".popup__photos");var c,l;return o.querySelector(".popup__title").textContent=r.title,o.querySelector(".popup__text--address").textContent=r.address,o.querySelector(".popup__text--price").textContent=r.price,o.querySelector(".popup__type").textContent={flat:"Квартрира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"}[r.type],o.querySelector(".popup__text--capacity").textContent=r.rooms+" комнаты для "+r.guests+" гостей.",o.querySelector(".popup__text--time").textContent=" Заезд после "+r.checkin+", выезд до "+r.checkout,((e,t)=>{var r;r=e,(0===t.features.length?(r.setAttribute("style","visibility: hidden;"),0):(r.setAttribute("style","visibility: visible;"),1))&&(e.innerHTML=t.features.map((e=>`<li class="popup__feature popup__feature--${e}"></li>`)).join(""))})(n,r),c=a,l=r.photos,c.innerHTML="",l.forEach((e=>{const t=document.createElement("img");t.src=e,t.width=45,t.height=40,c.appendChild(t)})),o.querySelector(".popup__avatar").src=t.avatar,o})(t),{}),n.on("click",O),P.push(n)}))},B=()=>{M.setView({lat:j,lng:F},10),I.setLatLng(L.latLng(j,F))};((e,t,r)=>{fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();r(`Не удалось загрузить данные об объектах: ${e.text}`)})).then((e=>{var t;U(e),t=_.debounce((()=>{P.forEach((e=>{e.remove()})),U(e)}),500),b.addEventListener("change",(()=>{t()})),C()})).catch(r)})(0,0,((e="Не удалось загрузить данные")=>()=>{const t=document.createElement("div");t.style.display="block",t.style.zIndex="100",t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.right="0",t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})("Не удалось загрузить данные об объектах"))})();
//# sourceMappingURL=main.bundle.js.map